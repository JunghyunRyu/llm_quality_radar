# 🎯 LLM Quality Radar - AI 기반 웹 자동화 테스트 시스템

## 📋 프로젝트 개요

**LLM Quality Radar**는 Google Application Development Kit(ADK)와 Playwright Model Context Protocol(MCP)을 연계한 혁신적인 웹 자동화 테스트 및 AI 기반 품질 분석 시스템입니다.

### 🌟 핵심 가치 제안

- **AI 기반 자동화**: Gemini 2.0 Flash 모델을 활용한 지능형 테스트 자동화
- **자연어 명령**: 복잡한 스크립트 작성 없이 자연어로 테스트 시나리오 작성
- **자동 복구**: ML 기반 오류 자동 감지 및 복구 시스템
- **종합 품질 분석**: 성능, 접근성, 반응형 디자인까지 통합 분석
- **실시간 모니터링**: Cloud 기반 실시간 품질 메트릭 수집

## 🏗️ 시스템 아키텍처

### 전체 구조
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   FastAPI App   │    │  Playwright     │    │   Google ADK    │
│   (Main Server) │◄──►│     MCP         │◄──►│   Integration   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Test Agent    │    │  Browser        │    │  AI/ML Models   │
│   (ADK Agent)   │    │  Control        │    │  (Gemini 2.0)   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 주요 컴포넌트

1. **FastAPI 메인 서버** (`app.py`)
   - RESTful API 엔드포인트 제공
   - 비동기 작업 관리
   - 웹 UI 서빙

2. **Google ADK 통합** (`core/google_adk_integration.py`)
   - Gemini 2.0 Flash 모델 연동
   - AI 기반 품질 분석
   - Cloud 서비스 통합

3. **Playwright MCP 클라이언트** (`core/mcp_client.py`)
   - 브라우저 자동화
   - 요소 조작 및 검증
   - 스크린샷 및 로그 수집

4. **자동 복구 시스템** (`core/auto_healing.py`)
   - ML 기반 오류 감지
   - 자동 복구 전략 실행
   - 패턴 인식 및 학습

5. **품질 모니터링** (`core/quality_monitor.py`)
   - 실시간 품질 메트릭 수집
   - 성능 분석
   - 접근성 검사

## 🚀 실행 방법

### 1. 환경 설정

#### 필수 요구사항
- **Python 3.8+**
- **Node.js 18+**
- **Windows 10/11** (현재 프로젝트 기준)

#### 가상환경 설정 (Windows)
```powershell
# 가상환경 생성
python -m venv venv

# 가상환경 활성화
venv\Scripts\activate

# 의존성 설치
pip install -r requirements.txt
```

#### Node.js 의존성 설치
```powershell
# Playwright MCP 설치
npm install

# 브라우저 설치
npx playwright install
```

### 2. Google Cloud 설정 (선택사항)

#### Google AI Studio API 키 설정 (권장 - 개발용)
```powershell
# 환경 변수 설정
$env:GOOGLE_API_KEY = "your-api-key-here"
$env:GOOGLE_GENAI_USE_VERTEXAI = "0"
```

#### Vertex AI 설정 (운영용)
```powershell
# Google Cloud 프로젝트 설정
$env:GOOGLE_CLOUD_PROJECT_ID = "your-project-id"
$env:GOOGLE_CLOUD_REGION = "us-central1"
$env:GOOGLE_APPLICATION_CREDENTIALS = "path\to\credentials.json"
$env:GOOGLE_GENAI_USE_VERTEXAI = "1"
```

### 3. 시스템 실행

#### 통합 실행 스크립트 사용 (권장)
```powershell
# 대화형 메뉴로 시스템 관리
python run_system.py
```

#### 메뉴 옵션
1. **시스템 시작**: FastAPI 서버 실행
2. **테스트 실행**: 자동 테스트 스위트 실행
3. **시스템 시작 + 테스트 실행**: 통합 실행
4. **종료**: 시스템 종료

#### 개별 컴포넌트 실행

**1. 메인 서버 시작**
```powershell
python app.py
```
- 서버: http://localhost:8000
- API 문서: http://localhost:8000/docs
- 웹 UI: http://localhost:8000/dashboard.html

**2. Playwright MCP 서버 시작**
```powershell
node playwright_mcp_server.js
```

**3. 테스트 데모 실행**
```powershell
# Google ADK 기본 기능 테스트
python simple_adk_demo.py

# Playwright MCP 통합 데모
python run_playwright_mcp_demo.py

# 전체 통합 테스트
python final_integration_test.py
```

### 4. 웹 UI 사용

#### 대시보드 (http://localhost:8000/dashboard.html)
- 실시간 시스템 상태 모니터링
- 테스트 결과 시각화
- 품질 메트릭 차트

#### 테스트 생성기 (http://localhost:8000/test-generator.html)
- 자연어 기반 테스트 시나리오 생성
- 코드 자동 생성
- 실시간 테스트 실행

## 📊 주요 기능 및 사용법

### 1. 웹 자동화 테스트

#### API 호출 방식
```bash
curl -X POST "http://localhost:8000/test" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://www.google.com",
    "test_scenarios": [
      {
        "action": "click",
        "selector": "input[name=\"q\"]",
        "description": "검색창 클릭"
      },
      {
        "action": "type",
        "selector": "input[name=\"q\"]",
        "value": "Google ADK MCP",
        "description": "검색어 입력"
      },
      {
        "action": "click",
        "selector": "input[value=\"Google 검색\"]",
        "description": "검색 버튼 클릭"
      }
    ],
    "auto_healing": true,
    "quality_checks": true
  }'
```

#### Python 클라이언트 방식
```python
from multi_tool_agent.adk_playwright_mcp_agent import ADKPlaywrightMCPAgent

# 에이전트 초기화
agent = ADKPlaywrightMCPAgent()
await agent.initialize()

# 자연어 명령으로 테스트 실행
query = """
Google.com으로 이동해서 'Google ADK MCP'를 검색하고,
결과 페이지의 스크린샷을 촬영해주세요.
"""

result = await agent.run_test_scenario(query)
print(f"테스트 결과: {result}")
```

### 2. AI 기반 품질 분석

#### 품질 분석 API
```bash
curl -X POST "http://localhost:8000/analysis/ai-enhanced" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://example.com",
    "test_scenarios": []
  }'
```

#### 분석 항목
- **성능 메트릭**: First Paint, DOM Content Loaded, Memory Usage
- **접근성 검사**: WCAG 가이드라인 준수 여부
- **반응형 디자인**: 다양한 뷰포트에서의 동작
- **SEO 최적화**: 메타 태그, 구조화된 데이터
- **보안 검사**: HTTPS, CSP 헤더 등

### 3. 자동 복구 시스템

#### 자동 복구 시나리오
- **요소 찾기 실패**: 대체 선택자 자동 시도
- **타이밍 이슈**: 동적 대기 시간 조정
- **네트워크 문제**: 자동 재시도 로직
- **브라우저 호환성**: 크로스 브라우저 대응

#### 복구 로그 확인
```python
# 복구 액션 조회
healing_actions = auto_healing.get_healing_actions()
for action in healing_actions:
    print(f"복구 시간: {action['timestamp']}")
    print(f"오류 유형: {action['error_type']}")
    print(f"복구 방법: {action['solution']}")
```

### 4. 분산 테스트 실행

#### Google Cloud Run 기반 분산 테스트
```bash
curl -X POST "http://localhost:8000/test/distributed" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://example.com",
    "test_scenarios": [...],
    "instances": 5
  }'
```

## 🛠️ 개발 및 커스터마이징

### 프로젝트 구조
```
llm_quality_radar/
├── app.py                          # 메인 FastAPI 서버
├── run_system.py                   # 통합 실행 스크립트
├── config/
│   └── adk_config.py              # Google ADK 설정
├── core/                          # 핵심 모듈
│   ├── mcp_client.py              # Playwright MCP 클라이언트
│   ├── google_adk_integration.py   # Google ADK 통합
│   ├── auto_healing.py            # 자동 복구 시스템
│   ├── quality_monitor.py         # 품질 모니터링
│   └── operational_manager.py     # 운영 관리
├── multi_tool_agent/              # AI 에이전트
│   └── adk_playwright_mcp_agent.py
├── public/                        # 웹 UI
│   ├── dashboard.html             # 대시보드
│   └── test-generator.html        # 테스트 생성기
├── utils/                         # 유틸리티
│   ├── config.py                  # 설정 관리
│   └── logger.py                  # 로깅 시스템
└── requirements.txt               # Python 의존성
```

### 커스텀 테스트 시나리오 추가

#### 1. 새로운 액션 타입 정의
```python
# core/mcp_client.py에 추가
async def custom_action(self, selector: str, action_data: dict):
    """커스텀 액션 실행"""
    try:
        # 커스텀 로직 구현
        await self._send_mcp_request("custom_action", {
            "selector": selector,
            "action_data": action_data
        })
        logger.info(f"커스텀 액션 완료: {selector}")
    except Exception as e:
        logger.error(f"커스텀 액션 실패: {e}")
        raise
```

#### 2. AI 에이전트 도구 확장
```python
# multi_tool_agent/에 새로운 에이전트 생성
class CustomTestAgent(ADKPlaywrightMCPAgent):
    def __init__(self):
        super().__init__()
        # 커스텀 도구 추가
        self.custom_tools = [...]
    
    async def run_custom_scenario(self, scenario):
        # 커스텀 시나리오 실행 로직
        pass
```

### API 엔드포인트 확장

#### FastAPI 라우터 추가
```python
# app.py에 추가
@app.post("/custom/endpoint")
async def custom_endpoint(request: CustomRequest):
    """커스텀 엔드포인트"""
    try:
        # 커스텀 로직 구현
        result = await custom_logic(request)
        return result
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))
```

## 📈 모니터링 및 로깅

### 로그 파일 위치
- **애플리케이션 로그**: `logs/app.log`
- **테스트 로그**: `logs/test.log`
- **에러 로그**: `logs/error.log`

### Cloud Logging 연동 (Google ADK)
```python
# Cloud Logging에 구조화된 로그 전송
await google_adk.log_to_cloud_logging({
    "level": "INFO",
    "message": "테스트 완료",
    "test_id": test_id,
    "quality_score": 85.5,
    "healing_actions": ["element_retry", "wait_adjustment"]
})
```

### 메트릭 모니터링
```python
# Cloud Monitoring 메트릭 생성
await google_adk.create_cloud_monitoring_metric({
    "metric_name": "test_success_rate",
    "value": 95.2,
    "test_id": test_id
})
```

## 🔧 문제 해결

### 일반적인 문제들

#### 1. MCP 서버 연결 실패
```powershell
# Playwright MCP 재설치
npm uninstall -g @playwright/mcp
npm install -g @playwright/mcp

# 브라우저 재설치
npx playwright install
```

#### 2. Google ADK 초기화 실패
```powershell
# 인증 확인
gcloud auth list

# 프로젝트 설정 확인
gcloud config get-value project
```

#### 3. 메모리 부족 오류
```powershell
# 브라우저 인스턴스 수 제한
$env:PLAYWRIGHT_MAX_INSTANCES = "2"
```

#### 4. 포트 충돌
```powershell
# 포트 8000 사용 중인 프로세스 확인
netstat -ano | findstr :8000

# 프로세스 종료
taskkill /PID [PID번호] /F
```

### 디버깅 모드 실행

#### 상세 로깅 활성화
```powershell
# 환경 변수 설정
$env:LOG_LEVEL = "DEBUG"
$env:PLAYWRIGHT_DEBUG = "1"

# 디버그 모드로 실행
python app.py
```

#### 브라우저 헤드풀 모드
```python
# config/adk_config.py에서 설정 변경
playwright_config = {
    "headless": False,  # 브라우저 창 표시
    "slow_mo": 1000     # 액션 간 대기 시간 (ms)
}
```

## 📚 추가 자료

### 문서
- **API 문서**: http://localhost:8000/docs (서버 실행 후)
- **Google ADK 가이드**: `README_ADK_PLAYWRIGHT_MCP.md`
- **설치 가이드**: `install_complete.md`
- **Firebase 배포**: `README_FIREBASE_DEPLOYMENT.md`

### 예제 테스트
- **기본 ADK 기능**: `simple_adk_demo.py`
- **MCP 통합**: `run_playwright_mcp_demo.py`
- **자동 테스트**: `auto_test_suite.py`
- **최종 통합**: `final_integration_test.py`

### 지원
- **이슈 리포트**: GitHub Issues
- **기능 요청**: GitHub Discussions
- **실시간 상태**: http://localhost:8000/status

---

**LLM Quality Radar**로 AI의 힘을 활용한 차세대 웹 테스트 자동화를 경험하세요! 🚀
